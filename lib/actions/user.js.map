{"version":3,"sources":["../../src/actions/user.js"],"names":["initiateLogin","logout","receiveLogin","saveProfile","updateLoginField","validateProfile","UserService","LOGOUT","REQUEST_LOGIN","RECEIVE_LOGIN","SAVE_PROFILE","UPDATE_LOGIN_FIELD","requestLogin","type","email","password","dispatch","login","then","profile","catch","error","logout_profile","response","storage","save","key","USER_PROFILE","rawData","value","getState","load","autoSync","status"],"mappings":";;;;;;QAqBgBA,a,GAAAA,a;QAiBAC,M,GAAAA,M;QAaAC,Y,GAAAA,Y;QAWAC,W,GAAAA,W;QAUAC,gB,GAAAA,gB;QAWAC,e,GAAAA,e;;AAnFhB;;IAAYC,W;;AACZ;;;;AAEO,IAAMC,0BAAS,QAAf;AACA,IAAMC,wCAAgB,eAAtB;AACA,IAAMC,wCAAgB,eAAtB;AACA,IAAMC,sCAAe,cAArB;AACA,IAAMC,kDAAqB,oBAA3B;;AAEP;;;AAGA,SAASC,YAAT,GAAwB;AACtB,SAAO;AACLC,UAAML;AADD,GAAP;AAGD;;AAED;;;AAGO,SAASR,aAAT,CAAuBc,KAAvB,EAA8BC,QAA9B,EAAwC;AAC7C,SAAO,oBAAY;AACjBC,aAASJ,cAAT;;AAEA,WAAON,YAAYW,KAAZ,CAAkBH,KAAlB,EAAyBC,QAAzB,EACJG,IADI,CACC,mBAAW;AACfF,eAASd,aAAa,EAACiB,SAASA,OAAV,EAAb,CAAT;AACAH,eAASb,YAAYgB,OAAZ,CAAT;AACA;AACD,KALI,EAMJC,KANI,CAME;AAAA,aAASJ,SAASd,aAAa,EAACmB,OAAOA,KAAR,EAAb,CAAT,CAAT;AAAA,KANF,CAAP;AAOD,GAVD;AAWD;;AAED;;;AAGO,SAASpB,MAAT,GAAkB;AACvB,SAAO,oBAAY;AACjB,QAAIqB,iBAAiB,EAArB;;AAEAN,aAAS,EAACH,MAAMN,MAAP,EAAT;AACAS,aAASb,YAAYmB,cAAZ,CAAT;AACA;AACD,GAND;AAOD;;AAED;;;AAGO,SAASpB,YAAT,CAAsBqB,QAAtB,EAAgC;AACrC,SAAO;AACLV,UAAMJ,aADD;AAELU,aAASI,SAASJ,OAFb;AAGLE,WAAOE,SAASF;AAHX,GAAP;AAKD;;AAED;;;AAGO,SAASlB,WAAT,CAAqBgB,OAArB,EAA8B;AACnC,SAAO,oBAAY;AACjBK,YAAQC,IAAR,CAAa,EAACC,KAAK,mBAAKC,YAAX,EAAyBC,SAAST,OAAlC,EAAb;AACAH,aAAS,EAACH,MAAMH,YAAP,EAAT;AACD,GAHD;AAID;;AAED;;;AAGO,SAASN,gBAAT,CAA0BsB,GAA1B,EAA+BG,KAA/B,EAAsC;AAC3C,SAAO;AACLhB,UAAMF,kBADD;AAELe,SAAKA,GAFA;AAGLG,WAAOA;AAHF,GAAP;AAKD;;AAED;;;AAGO,SAASxB,eAAT,GAA2B;AAChC,SAAO,UAACW,QAAD,EAAWc,QAAX,EAAwB;AAC7B,WAAON,QAAQO,IAAR,CAAa,EAACL,KAAK,mBAAKC,YAAX,EAAyBK,UAAU,KAAnC,EAAb,EACJd,IADI,CACC,mBAAW;AACf,UAAIC,WAAWA,QAAQc,MAAR,KAAmB,eAAlC,EAAmD;AACjDjB,iBAASd,aAAa,EAACiB,SAASA,OAAV,EAAb,CAAT;AACA;AACD;AACF,KANI,EAOJC,KAPI,CAOE,iBAAS;AACd;AACAJ,eAASb,YAAY,EAAZ,CAAT;AACD,KAVI,CAAP;AAWD,GAZD;AAaD","file":"user.js","sourcesContent":["import * as UserService from '../services/user';\nimport {KEYS} from '../constants/localStorage';\n\nexport const LOGOUT = 'LOGOUT';\nexport const REQUEST_LOGIN = 'REQUEST_LOGIN';\nexport const RECEIVE_LOGIN = 'RECEIVE_LOGIN';\nexport const SAVE_PROFILE = 'SAVE_PROFILE';\nexport const UPDATE_LOGIN_FIELD = 'UPDATE_LOGIN_FIELD';\n\n/**\n * invoked when a login is requested\n */\nfunction requestLogin() {\n  return {\n    type: REQUEST_LOGIN\n  };\n}\n\n/**\n * initiates a login request\n */\nexport function initiateLogin(email, password) {\n  return dispatch => {\n    dispatch(requestLogin());\n\n    return UserService.login(email, password)\n      .then(profile => {\n        dispatch(receiveLogin({profile: profile}));\n        dispatch(saveProfile(profile));\n        //dispatch(push('/dashboard'));\n      })\n      .catch(error => dispatch(receiveLogin({error: error})));\n  }\n}\n\n/**\n * logout user - delete profile, redirect to /\n */\nexport function logout() {\n  return dispatch => {\n    let logout_profile = {};\n\n    dispatch({type: LOGOUT});\n    dispatch(saveProfile(logout_profile));\n    // dispatch(push('/'));\n  };\n}\n\n/**\n * invoked when a login is received - success or error\n */\nexport function receiveLogin(response) {\n  return {\n    type: RECEIVE_LOGIN,\n    profile: response.profile,\n    error: response.error\n  };\n}\n\n/**\n * save profile to storage - could be expanded to be cross platform (react-native-storage)\n */\nexport function saveProfile(profile) {\n  return dispatch => {\n    storage.save({key: KEYS.USER_PROFILE, rawData: profile});\n    dispatch({type: SAVE_PROFILE});\n  }\n}\n\n/**\n * set the value for a login field (email, password, etc.)\n */\nexport function updateLoginField(key, value) {\n  return {\n    type: UPDATE_LOGIN_FIELD,\n    key: key,\n    value: value\n  };\n}\n\n/**\n * validates a user profile\n */\nexport function validateProfile() {\n  return (dispatch, getState) => {\n    return storage.load({key: KEYS.USER_PROFILE, autoSync: false})\n      .then(profile => {\n        if (profile && profile.status === 'authenticated') {\n          dispatch(receiveLogin({profile: profile}));\n          // dispatch(push(next_route));\n        }\n      })\n      .catch(error => {\n        // handle missing profile\n        dispatch(saveProfile({}));\n      });\n  }\n}\n"]}